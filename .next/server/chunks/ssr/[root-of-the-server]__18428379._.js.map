{"version":3,"sources":["../../../../src/lib/data.ts","../../../../src/components/PageTransition.tsx/__nextjs-internal-proxy.mjs","../../../../src/components/HomeClient.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/page.tsx"],"sourcesContent":["// Define the Post type matches the API structure\nexport interface Post {\n    cid: number;\n    title: string;\n    text: string;\n    created: number; // Unix timestamp\n    author?: { screenName: string };\n    tag?: { name: string }[];\n    directory?: string;\n}\n\nexport interface ApiResponse<T> {\n    data: T;\n    total?: number;\n}\n\nconst API_BASE_URL = 'https://blog.tianiel.top/api';\n\nconst TOTAL_COUNT_CACHE_TAG = 'blog-total-count';\n\nasync function getTotalCount(): Promise<number> {\n    try {\n        // Fetch a large number to count total posts (Workaround for missing total header)\n        // Cached for 5 minutes\n        const res = await fetch(`${API_BASE_URL}/posts?page=1&pageSize=1000`, {\n            next: { revalidate: 300, tags: [TOTAL_COUNT_CACHE_TAG] }\n        });\n        if (!res.ok) return 0;\n        const data = await res.json();\n        return Array.isArray(data.data) ? data.data.length : 0;\n    } catch (e) {\n        console.error(\"Error fetching total count:\", e);\n        return 0;\n    }\n}\n\nexport async function getAllPosts(page = 1, pageSize = 10): Promise<{ posts: Post[], total: number }> {\n    try {\n        // Parallel fetch: posts for current page + total count (cached)\n        const [postsResponse, totalCount] = await Promise.all([\n            fetch(`${API_BASE_URL}/posts?page=${page}&pageSize=${pageSize}`, {\n                next: { revalidate: 60 }\n            }).then(r => r.json()),\n            getTotalCount()\n        ]);\n\n        // Parse posts from data.data\n        // Response structure is { status: 200, data: [...] } based on curl verification\n        const rawPosts = postsResponse.data || [];\n\n        let posts: Post[] = [];\n        if (Array.isArray(rawPosts)) {\n            posts = rawPosts.map((item: any) => ({\n                cid: Number(item.cid),\n                title: item.title,\n                text: item.text,\n                created: Number(item.created), // API returns explicit \"created\" timestamp string\n                author: item.author,\n                tag: item.tag,\n                directory: item.directory\n            }));\n        }\n\n        return {\n            posts,\n            total: totalCount || posts.length\n        };\n    } catch (error) {\n        console.error(\"Error fetching posts:\", error);\n        return { posts: [], total: 0 };\n    }\n}\n\nexport async function getPostById(id: string): Promise<Post | undefined> {\n    try {\n        const res = await fetch(`${API_BASE_URL}/post?cid=${id}`, {\n            next: { revalidate: 60 }\n        });\n\n        if (!res.ok) {\n            // API might return 404 or just null data\n            return undefined;\n        }\n\n        const data: ApiResponse<Post> = await res.json();\n\n        if (!data.data) return undefined;\n\n        // Ensure created is a number\n        return {\n            ...data.data,\n            created: Number(data.data.created)\n        };\n    } catch (error) {\n        console.error(`Error fetching post ${id}:`, error);\n        return undefined;\n    }\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/PageTransition.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/PageTransition.tsx\",\n    \"default\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/HomeClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/HomeClient.tsx\",\n    \"default\",\n);\n","import { getAllPosts } from \"@/lib/data\";\nimport HomeClient from \"@/components/HomeClient\";\nimport PageTransition from \"@/components/PageTransition\";\n\n// 强制动态渲染，保证每次刷新都能看到最新文章\nexport const dynamic = \"force-dynamic\";\n\nexport default async function HomePage() {\n    // 1. 获取所有文章 (API 默认按时间倒序)\n    const { posts } = await getAllPosts(1, 4);\n\n    // 2. 格式化数据\n    const serializedPosts = posts.map((post) => {\n        const rawCategory = post.directory;\n        const safeCategory =\n            typeof rawCategory === \"string\" && rawCategory.trim().length > 0\n                ? rawCategory\n                : \"Life\";\n\n        return {\n            id: post.cid.toString(),\n            title: post.title,\n            content: post.text,\n            category: safeCategory,\n            createdAt: new Date(post.created * 1000).toISOString(),\n        };\n    });\n\n    return (\n        <PageTransition>\n            <HomeClient initialPosts={serializedPosts} />\n        </PageTransition>\n    );\n}\n"],"names":[],"mappings":"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","ignoreList":[1,2]}