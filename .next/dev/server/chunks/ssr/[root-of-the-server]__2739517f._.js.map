{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///E:/my-geek-blog/src/lib/data.ts"],"sourcesContent":["// Define the Post type matches the API structure\nexport interface Post {\n    cid: number;\n    title: string;\n    text: string;\n    created: number; // Unix timestamp\n    author?: { screenName: string };\n    tag?: { name: string }[];\n    directory?: string;\n}\n\nexport interface ApiResponse<T> {\n    data: T;\n    total?: number;\n}\n\nconst API_BASE_URL = 'https://blog.tianiel.top/api';\n\nconst TOTAL_COUNT_CACHE_TAG = 'blog-total-count';\n\nasync function getTotalCount(): Promise<number> {\n    try {\n        // Fetch a large number to count total posts (Workaround for missing total header)\n        // Cached for 5 minutes\n        const res = await fetch(`${API_BASE_URL}/posts?page=1&pageSize=1000`, {\n            next: { revalidate: 300, tags: [TOTAL_COUNT_CACHE_TAG] }\n        });\n        if (!res.ok) return 0;\n        const data = await res.json();\n        return Array.isArray(data.data) ? data.data.length : 0;\n    } catch (e) {\n        console.error(\"Error fetching total count:\", e);\n        return 0;\n    }\n}\n\nexport async function getAllPosts(page = 1, pageSize = 10): Promise<{ posts: Post[], total: number }> {\n    try {\n        // Parallel fetch: posts for current page + total count (cached)\n        const [postsResponse, totalCount] = await Promise.all([\n            fetch(`${API_BASE_URL}/posts?page=${page}&pageSize=${pageSize}`, {\n                next: { revalidate: 60 }\n            }).then(r => r.json()),\n            getTotalCount()\n        ]);\n\n        // Parse posts from data.data\n        // Response structure is { status: 200, data: [...] } based on curl verification\n        const rawPosts = postsResponse.data || [];\n\n        let posts: Post[] = [];\n        if (Array.isArray(rawPosts)) {\n            posts = rawPosts.map((item: any) => ({\n                cid: Number(item.cid),\n                title: item.title,\n                text: item.text,\n                created: Number(item.created), // API returns explicit \"created\" timestamp string\n                author: item.author,\n                tag: item.tag,\n                directory: item.directory\n            }));\n        }\n\n        return {\n            posts,\n            total: totalCount || posts.length\n        };\n    } catch (error) {\n        console.error(\"Error fetching posts:\", error);\n        return { posts: [], total: 0 };\n    }\n}\n\nexport async function getPostById(id: string): Promise<Post | undefined> {\n    try {\n        const res = await fetch(`${API_BASE_URL}/post?cid=${id}`, {\n            next: { revalidate: 60 }\n        });\n\n        if (!res.ok) {\n            // API might return 404 or just null data\n            return undefined;\n        }\n\n        const data: ApiResponse<Post> = await res.json();\n\n        if (!data.data) return undefined;\n\n        // Ensure created is a number\n        return {\n            ...data.data,\n            created: Number(data.data.created)\n        };\n    } catch (error) {\n        console.error(`Error fetching post ${id}:`, error);\n        return undefined;\n    }\n}\n"],"names":[],"mappings":"AAAA,iDAAiD;;;;;;;AAgBjD,MAAM,eAAe;AAErB,MAAM,wBAAwB;AAE9B,eAAe;IACX,IAAI;QACA,kFAAkF;QAClF,uBAAuB;QACvB,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,2BAA2B,CAAC,EAAE;YAClE,MAAM;gBAAE,YAAY;gBAAK,MAAM;oBAAC;iBAAsB;YAAC;QAC3D;QACA,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;QACpB,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO,MAAM,OAAO,CAAC,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,MAAM,GAAG;IACzD,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACX;AACJ;AAEO,eAAe,YAAY,OAAO,CAAC,EAAE,WAAW,EAAE;IACrD,IAAI;QACA,gEAAgE;QAChE,MAAM,CAAC,eAAe,WAAW,GAAG,MAAM,QAAQ,GAAG,CAAC;YAClD,MAAM,GAAG,aAAa,YAAY,EAAE,KAAK,UAAU,EAAE,UAAU,EAAE;gBAC7D,MAAM;oBAAE,YAAY;gBAAG;YAC3B,GAAG,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI;YACnB;SACH;QAED,6BAA6B;QAC7B,gFAAgF;QAChF,MAAM,WAAW,cAAc,IAAI,IAAI,EAAE;QAEzC,IAAI,QAAgB,EAAE;QACtB,IAAI,MAAM,OAAO,CAAC,WAAW;YACzB,QAAQ,SAAS,GAAG,CAAC,CAAC,OAAc,CAAC;oBACjC,KAAK,OAAO,KAAK,GAAG;oBACpB,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,SAAS,OAAO,KAAK,OAAO;oBAC5B,QAAQ,KAAK,MAAM;oBACnB,KAAK,KAAK,GAAG;oBACb,WAAW,KAAK,SAAS;gBAC7B,CAAC;QACL;QAEA,OAAO;YACH;YACA,OAAO,cAAc,MAAM,MAAM;QACrC;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;YAAE,OAAO,EAAE;YAAE,OAAO;QAAE;IACjC;AACJ;AAEO,eAAe,YAAY,EAAU;IACxC,IAAI;QACA,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,UAAU,EAAE,IAAI,EAAE;YACtD,MAAM;gBAAE,YAAY;YAAG;QAC3B;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACT,yCAAyC;YACzC,OAAO;QACX;QAEA,MAAM,OAA0B,MAAM,IAAI,IAAI;QAE9C,IAAI,CAAC,KAAK,IAAI,EAAE,OAAO;QAEvB,6BAA6B;QAC7B,OAAO;YACH,GAAG,KAAK,IAAI;YACZ,SAAS,OAAO,KAAK,IAAI,CAAC,OAAO;QACrC;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,CAAC,oBAAoB,EAAE,GAAG,CAAC,CAAC,EAAE;QAC5C,OAAO;IACX;AACJ"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///E:/my-geek-blog/src/components/HomeClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/HomeClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/HomeClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAiS,GAC9T,+DACA","ignoreList":[0]}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///E:/my-geek-blog/src/components/HomeClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/HomeClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/HomeClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA6Q,GAC1S,2CACA","ignoreList":[0]}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///E:/my-geek-blog/src/components/PageTransition.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/PageTransition.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/PageTransition.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAqS,GAClU,mEACA","ignoreList":[0]}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///E:/my-geek-blog/src/components/PageTransition.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/PageTransition.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/PageTransition.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAiR,GAC9S,+CACA","ignoreList":[0]}},
    {"offset": {"line": 184, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///E:/my-geek-blog/src/app/page.tsx"],"sourcesContent":["import { getAllPosts } from \"@/lib/data\";\nimport HomeClient from \"@/components/HomeClient\";\nimport PageTransition from \"@/components/PageTransition\";\n\n// 强制动态渲染，保证每次刷新都能看到最新文章\nexport const dynamic = \"force-dynamic\";\n\nexport default async function HomePage() {\n    // 1. 获取所有文章 (API 默认按时间倒序)\n    const { posts } = await getAllPosts(1, 4);\n\n    // 2. 格式化数据\n    const serializedPosts = posts.map((post) => {\n        const rawCategory = post.directory;\n        const safeCategory =\n            typeof rawCategory === \"string\" && rawCategory.trim().length > 0\n                ? rawCategory\n                : \"Life\";\n\n        return {\n            id: post.cid.toString(),\n            title: post.title,\n            content: post.text,\n            category: safeCategory,\n            createdAt: new Date(post.created * 1000).toISOString(),\n        };\n    });\n\n    return (\n        <PageTransition>\n            <HomeClient initialPosts={serializedPosts} />\n        </PageTransition>\n    );\n}\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;;;;;AAGO,MAAM,UAAU;AAER,eAAe;IAC1B,0BAA0B;IAC1B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,iIAAW,EAAC,GAAG;IAEvC,WAAW;IACX,MAAM,kBAAkB,MAAM,GAAG,CAAC,CAAC;QAC/B,MAAM,cAAc,KAAK,SAAS;QAClC,MAAM,eACF,OAAO,gBAAgB,YAAY,YAAY,IAAI,GAAG,MAAM,GAAG,IACzD,cACA;QAEV,OAAO;YACH,IAAI,KAAK,GAAG,CAAC,QAAQ;YACrB,OAAO,KAAK,KAAK;YACjB,SAAS,KAAK,IAAI;YAClB,UAAU;YACV,WAAW,IAAI,KAAK,KAAK,OAAO,GAAG,MAAM,WAAW;QACxD;IACJ;IAEA,qBACI,8OAAC,+IAAc;kBACX,cAAA,8OAAC,2IAAU;YAAC,cAAc;;;;;;;;;;;AAGtC"}}]
}